<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FAQ – Vaccination (HPV & Méningocoque)</title>
  <style>
    :root { --bg:#0b1220; --card:#0f1a30; --text:#eaf0ff; --muted:#b7c3e6; --border:rgba(255,255,255,.12); --accent:#6aa7ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); }
    a { color:var(--accent); }
    header { padding: 22px 16px 12px; max-width: 980px; margin: 0 auto; }
    h1 { margin:0 0 6px; font-size: 20px; font-weight: 750; letter-spacing: .2px; }
    .sub { margin:0; color:var(--muted); font-size: 13px; line-height: 1.35; }
    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top: 14px; }
    select, input {
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
    }
    input { flex: 1 1 320px; min-width: 220px; }
    select { flex: 0 0 auto; }
    main { max-width: 980px; margin: 0 auto; padding: 0 16px 28px; }
    .section { margin-top: 18px; padding: 14px 14px; border: 1px solid var(--border); border-radius: 14px; background: rgba(255,255,255,.03); }
    .section h2 { margin: 0 0 10px; font-size: 16px; color: var(--text); }
    details { border: 1px solid var(--border); border-radius: 12px; background: rgba(255,255,255,.04); padding: 10px 12px; margin: 10px 0; }
    summary { cursor: pointer; list-style: none; font-weight: 650; }
    summary::-webkit-details-marker { display:none; }
    .answer { margin-top: 10px; color: var(--text); line-height: 1.5; }
    .muted { color: var(--muted); font-size: 12px; }
    .pill { display:inline-block; padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; font-size: 12px; color: var(--muted); }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .footer { max-width: 980px; margin: 0 auto; padding: 0 16px 22px; color: var(--muted); font-size: 12px; }
    .rtl { direction: rtl; text-align: right; }
  </style>
</head>
<body>
  <header>
    <h1 id="pageTitle">FAQ – Vaccination</h1>
    <p class="sub" id="pageSubtitle">HPV & Méningocoque • Version multilingue (FR / AR / TR / EN / PS / KU)</p>

    <div class="toolbar">
      <select id="langSelect" aria-label="Langue"></select>
      <input id="searchInput" type="search" placeholder="Rechercher (toutes langues)..." aria-label="Rechercher" />
      <span class="pill" id="countPill">0 questions</span>
    </div>
    <p class="muted" style="margin:10px 0 0;">Astuce : tapez un mot-clé (ex. “HPV”, “meningite”, “عقم”, “kısırlık”).</p>
  </header>

  <main id="app"></main>

  <div class="footer">
    <div>Fichier de données : <code>faq.json</code>. Vous pouvez ajouter/modifier des questions en éditant le JSON.</div>
  </div>

<script>
(async function(){
  const RTL_LANGS = new Set(["ar","ps","ku"]);
  const FALLBACK_LANG = "fr";

  const $app = document.getElementById("app");
  const $lang = document.getElementById("langSelect");
  const $search = document.getElementById("searchInput");
  const $count = document.getElementById("countPill");
  const $title = document.getElementById("pageTitle");

  function normalize(s){
    return (s || "").toString().toLowerCase()
      .normalize("NFD").replace(/\p{Diacritic}/gu,"");
  }

  function getText(obj, lang){
    if(!obj) return "";
    return obj[lang] || obj[FALLBACK_LANG] || "";
  }

  function applyDir(lang){
    const isRtl = RTL_LANGS.has(lang);
    document.documentElement.dir = isRtl ? "rtl" : "ltr";
    document.documentElement.lang = lang;
    document.body.classList.toggle("rtl", isRtl);
  }

  const res = await fetch("./faq.json", { cache: "no-store" });
  const data = await res.json();

  // Build language selector
  const langs = data.meta.languages;
  langs.forEach(code => {
    const opt = document.createElement("option");
    opt.value = code;
    opt.textContent = data.meta.lang_labels[code] || code.toUpperCase();
    $lang.appendChild(opt);
  });

  // Default language: French
  let currentLang = "fr";
  $lang.value = currentLang;

  function filterItems(items, query){
    const q = normalize(query);
    if(!q) return items;
    return items.filter(it => {
      const hay = Object.keys(it.q || {}).concat(Object.keys(it.a || {}))
        .map(k => normalize((it.q||{})[k]) + " " + normalize((it.a||{})[k]))
        .join(" ");
      return hay.includes(q);
    });
  }

  function render(){
    const query = $search.value || "";
    const filtered = filterItems(data.items, query);

    // Title in chosen language if available
    $title.textContent = getText(data.meta.title, currentLang) || "FAQ";

    applyDir(currentLang);
    $app.innerHTML = "";

    // group by section
    const bySection = new Map();
    filtered.forEach(it => {
      const key = it.section || "general";
      if(!bySection.has(key)) bySection.set(key, []);
      bySection.get(key).push(it);
    });

    // render sections in order defined by data.sections
    let total = 0;
    data.sections.forEach(sec => {
      const items = bySection.get(sec.key) || [];
      if(items.length === 0) return;

      total += items.length;

      const sectionDiv = document.createElement("section");
      sectionDiv.className = "section";
      const h2 = document.createElement("h2");
      h2.textContent = getText(sec.title, currentLang);
      sectionDiv.appendChild(h2);

      items.forEach(it => {
        const det = document.createElement("details");
        const sum = document.createElement("summary");
        sum.textContent = getText(it.q, currentLang);
        det.appendChild(sum);

        const ans = document.createElement("div");
        ans.className = "answer";
        ans.textContent = getText(it.a, currentLang);
        det.appendChild(ans);

        sectionDiv.appendChild(det);
      });

      $app.appendChild(sectionDiv);
    });

    $count.textContent = `${total} question${total>1?"s":""}`;
    if(total === 0){
      const empty = document.createElement("div");
      empty.className = "section";
      empty.innerHTML = "<h2>Aucun résultat</h2><div class='muted'>Essayez un autre mot-clé.</div>";
      $app.appendChild(empty);
    }
  }

  $lang.addEventListener("change", () => { currentLang = $lang.value; render(); });
  $search.addEventListener("input", () => render());

  render();
})();
</script>
</body>
</html>
